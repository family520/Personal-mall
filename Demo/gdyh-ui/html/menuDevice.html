<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../images/logoIcon.png" type="image/icon"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>【光大银行】智慧综合管理系统</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../css/style.min.css" rel="stylesheet">
    <link href="../plus/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="../css/bootstrap-treeview.css" rel="stylesheet">
    <link href="../css/commonStyle.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../plus/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../plus/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="../plus/layer/layer.js"></script>
    <script src="../js/template-web.js"></script>
    <script src="../plus/validate/jquery.validate.min.js"></script>
    <script src="../plus/validate/messages_zh.min.js"></script>
    <script src="../js/bootstrap-treeview.js"></script>

    <script src="../js/httpUtils.js"></script>
    <script src="../js/Md5.js"></script>
    <script src="../plus/iview/vue.min.js"></script>
    <style type="text/css">
        .simButton {
            padding: 8px;
        }
        #DemoBox {
            width: 100%;
            height: 100%;
            position: fixed;
            left: 50%;
            top: 50%;
            z-index: 500;
            transform: translate(-50%, -50%);
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2);
        }

        .ss_cont {
            background-color: white;
            width: 700px;
            height: 600px;
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 300;
            transform: translate(-50%, -50%);
            overflow: hidden;
            box-shadow: 0 0 10px 2px rgba(0, 0, 0, 0.3);
        }

        #Example2 {
            /*border: 1px solid red;*/
            width: 700px;
            height: 600px;
        }

        .goOut {
            position: relative;
            /*border: 1px solid red;*/
            height: 40px;
            line-height: 40px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            background: #f8f8f8;
        }

        .goOut i {
            height: 20px;
            width: 20px;
            /*border: 1px solid red;*/
            position: absolute;
            top: 0;
            right: 35px;
            cursor: pointer;
        }

        .device_row {
            border: 1px solid rgba(77, 82, 89, 0.05);
            line-height: 40px;
            min-height: 40px;
            margin: 5px 0;
        }

        .device_row span {
            margin-right: 10px;
        }

        .device_remove {
            float: right;
            cursor: pointer;
        }
    </style>
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!--加载头部和菜单栏-->
        <div id="hander">
            <script>
                $(function () {
                    $("#hander").load("handMenu.html");
                });
            </script>
        </div>
        <!--页面主要内容-->
        <main class="lyear-layout-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>多路多键设备</h4>
                            </div>
                            <div class="card-body">
                                <div class="ibox-content row">
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-label" for="s_deviceName">设备名称：</label>
                                            <input class="form-control" name="s_deviceName" id="s_deviceName" placeholder="设备名称" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-label" for="s_deviceMac">设备mac：</label>
                                            <input class="form-control" name="s_deviceMac" id="s_deviceMac" placeholder="设备mac" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <div style="margin-top: 24px;">
                                                <button type="button" class="btn btn-purple" id="clean"><i
                                                        class="fa fa-eraser"></i> 清空
                                                </button>
                                                <button type="button" class="btn btn-success" id="search"
                                                        style="margin-left: 10px"><i class="fa fa-search"></i> 查询
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Start-->
                               <!-- <div class="ibox-content">
                                    &lt;!&ndash;页面内容部分&ndash;&gt;
                                    &lt;!&ndash; 这里写内容 &ndash;&gt;
                                    <div id="buttons">
                                        <button type="button" class="btn btn-primary" id="addSlibings" onclick="newEvent()"><i class="fa fa-plus"></i>
                                            录入
                                        </button>
                                    </div>

                                    <div id="myTable">

                                    </div>
                                </div>-->
                                <table id="deviceEventList"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!--End 页面主要内容-->

    </div>
</div>
<!--加载底部-->
<div id="footer" class="classifyFooter">
    <script type="text/javascript">
        $(function () {
            $("#footer").load("footer.html");
        });
    </script>
</div>
<div id="loadDiv"></div>
<div id="DemoBox" style="display: none" class="card">
    <div class="ss_cont">
        <div class="row goOut" style="text-align: left;padding-left:30px">
            控制
            <i class="goOff" aria-hidden="true">
                <img src="../images/remove.png" alt="">
            </i>
        </div>
        <iframe id="Example2" class="card" title="Example2" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" srcdoc=''>
        </iframe>
    </div>
</div>
</body>
<script type="text/javascript">
    $("#loadDiv").html(loadHtml);
    let html;
    $(function () {
        $('#deviceEventList').bootstrapTable({
            url: deviceServiceUrl + "/device/getMenuList", //请求后台的URL（*）
            //data: data1,                            //本地数据
            method: 'get', //请求方式（*）
            contentType: "application/x-www-form-urlencoded",
            toolbar: '', //工具按钮用哪个容器
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sortable: false, //是否启用排序
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 10, //每页的记录行数（*）
            pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
            queryParamsType: '',
            queryParams: queryParams, //传递参数（*）
            strictSearch: true,
            // height: 500,                            //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "id", //每一行的唯一标识，一般为主键列
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            clickToSelect: true, //点击行是否选中
            responseHandler: function (data) {
                var res = [];
                if (data.code == 0) {
                    var result = data.data;
                    rdata = result.list;
                    res.push({
                        total: result.total,
                        rows: result.list
                    });
                    $.hide_overall_loding();
                    return res[0];
                } else {
                    res.push({
                        total: 0,
                        rows: []
                    });
                    layer.msg("获取数据失败！", {icon: 2});
                    $.hide_overall_loding();
                    return res[0];
                }
            },
            onLoadSuccess: function () {
                $.hide_overall_loding();
            },
            onDblClickRow: function (row) {
                console.info(row);
            },
            columns: [{
                checkbox: true
            }, {
                width: 50,
                title: '序号',
                formatter: function (value, row, index) {
                    let pageSize = $('#deviceEventList').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                    let pageNumber = $('#deviceEventList').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                    return pageSize * (pageNumber - 1) + index + 1;
                }
            }, {
                field: 'deviceAlias',
                title: '设备名称',
                width: 100
            }, {
                field: 'deviceMac',
                title: '设备mac',
                width: 100
            },{
                field: 'deviceSubscriberNumber',
                title: '订阅账号',
                width: 100
            }, {
                field: 'deviceState',
                title: '设备状态',
                width: 80,
                formatter: function(value, row, index) {
                    var state = "";
                    if(value == 1) {
                        state = '<span style="color:green">正常</span>'
                    } else if(value == 2) {
                        state = '<span style="color:aquamarine">离线</span>'
                    } else if(value == 3) {
                        state = '<span style="color:red">报警</span>'
                    } else if(value == 4) {
                        state = '<span style="color:red">故障</span>'
                    } else if(value == 5) {
                        state = '<span style="color:red">过流</span>'
                    } else if(value == 6) {
                        state = '<span style="color:red">过压</span>'
                    }
                    return state;
                }
            },{
                field: 'menuType',
                title: '几路几键',
                width: 80,
                formatter: function(value, row, index) {
                    let menuTypeList = ["三路三键","三路四键","三路五键","三路六键","两路两键","两路三键","两路四键","两路五键","两路六键","一路一键"];
                    if(value == "" || value == null){
                        return  "-";
                    }else {
                        return menuTypeList[value-1];
                    }
                }
            },{
                field: 'organizationName',
                title: '所属机构',
                width: 100
            },{
                field: 'createDate',
                title: '创建时间',
                width: 100
            },{
                title: "操作",
                width: 150,
                clickToSelect: false,
                formatter: function (i1, i2, i3) {
                    var str = '' +
                        '<button data-toggle="tooltip" title="绑定模式" type="button" onclick="bandingModel(' + i3 +
                        ');" class="btn btn-purple tableButton"><i class="fa fa-plus"> </i></button>' +
                        '<button data-toggle="tooltip" title="编辑" type="button" onclick="editEvent(' + i3 +
                        ');" class="btn btn-warning tableButton"><i class="fa fa-pencil-square"> </i></button>'+
                        '<button data-toggle="tooltip" title="设备控制" type="button" onclick="consoleDevice(' + i3 +
                        ');" class="btn btn-purple tableButton"><i class="fa fa-puzzle-piece"> </i></button>';
                    return str;
                },
                cellStyle: function () {
                    return {
                        classes: "",
                        css: {
                            "text-align": "center"
                        }
                    }
                }
            }]
        });

        function queryParams(params) {
            return {
                token: $.getToken(),
                pageSize: params.pageSize,
                pageNum: params.pageNumber,
                deviceAlias:$("#s_deviceName").val(),
                deviceMac:$("#s_deviceMac").val(),
            };
        }

        $("#search").on("click", function () {
            $('#deviceEventList').bootstrapTable('refresh');
        });

        $("#clean").click(function () {
            $("#s_deviceName").val("");
            $("#s_deviceMac").val("");
            $("#search").trigger("click");
        });
    });

    function abdc(datas) {
        $.show_overall_loding();
        /*if(datas.menuId != null){//按键有关联控制模式
            $.postJSON(deviceServiceUrl + "/mode/controlMode?id=" + datas.menuId, {}, function(data) {
                $.hide_overall_loding();
                if(data.code == 0) {
                    layer.msg("模式控制成功", {
                        icon: 1
                    });
                    return true;
                }
                layer.msg("模式控制操作失败", {
                    icon: 2
                });
            });
        }*/
        let formData = {};
        formData.account = item.deviceSubscriberNumber;
        formData.controlParams = JSON.stringify(datas.controlParams);
        formData.operation = datas.operation;
        formData.productId = item.productCode;
        formData.serial_num = item.serialNum;
        formData.onOff = datas.onOff;
        formData.deviceId = item.id;
        formData.menuIndex = datas.menuIndex;
        $.postJSON(deviceServiceUrl +"/threeSwitchMenu/controlDervice_s",formData,function (conRes) {
            $.hide_overall_loding();
            if(conRes.code == 0){
                let dataRes = conRes.data;
                if(dataRes == null || dataRes == ''){
                    layer.msg("设备控制失败",{icon:2});
                    return;
                }
                let contentRes = dataRes.resultContent;
                if(contentRes == null || contentRes == "" || contentRes.code != 0){
                    layer.msg("设备控制失败",{icon:2});
                }else {
                    layer.msg("设备控制成功",{icon:1});
                }
            }else {
                layer.msg("设备控制失败",{icon:2});
            }
        })
    }

    let item;
    //控制设备开始
    function consoleDevice(id){
        $.show_overall_loding();
        let dataList = $("#deviceEventList").bootstrapTable("getData");
        if(dataList[id].menuType == null){
            $.hide_overall_loding();
            layer.msg("未选择具体几路几键",{icon: 2});
            return;
        }
        item = $("#deviceEventList").bootstrapTable("getData")[id];
        //iframe层-父子操作
        layer.open({
            type: 2,
            area: ['700px', '450px'],
            fixed: false, //不固定
            maxmin: true,
            content: 'menusTemplate.html',
            success:function(){
                $.hide_overall_loding();
                $(".layui-layer-iframe iframe")[0].contentWindow.init(item);//多路多键初始化
            }
        });
        /*$.getJSON(deviceServiceUrl + "/device/getTemplateByMenuType?token="+$.getToken()+"&menuType="+dataList[id].menuType,function (getRes) {
            if(!getRes.data) {
                $.hide_overall_loding();
                layer.msg("没有对应的控制模版", {
                    icon: 2
                });
                return false;
            }
            if(dataList[id].menuType == 1 || dataList[id].menuType == 5 || dataList[id].menuType == 6 || dataList[id].menuType == 10){
                $(".ss_cont").css("height","300px");
            }else {
                $(".ss_cont").css("height","500px");
            }
            document.getElementById("Example2").srcdoc = getRes.data;
            $("#Example2").load(function() {
                $.hide_overall_loding();
                $("#Example2").contents().find(".sendControlBtn2").unbind();
                $("#Example2").contents().find(".sendControlBtn2").on("click", function() {
                    $.show_overall_loding();
                    let params = $("#Example2")[0].contentWindow.getCmdParams($(this));
                    if(dataList[id][params.menuName] == null || dataList[id][params.menuName] == ""){//按钮没有绑定模式
                        let formData = {};
                        formData.account = dataList[id].deviceSubscriberNumber;
                        formData.controlParams = JSON.stringify(params.controlParams);
                        formData.operation = params.operation;
                        formData.productId = dataList[id].productCode;
                        formData.serial_num = dataList[id].serialNum;
                        $.postJSON(deviceServiceUrl +"/device/controlDervice_s",formData,function (conRes) {
                            $.hide_overall_loding();
                            if(conRes.code == 0){//当前平台返回结果
                                if(conRes.data != null || conRes.data != ""){//当前平台返回结果
                                    if(conRes.data.resultContent != null || conRes.data.resultContent != ""){//bcca平台返回结果
                                        let resContent = conRes.data.resultContent;
                                        if(resContent.code == 0){
                                            layer.msg("控制成功",{icon:1});
                                        }else if(resContent.code == -1){
                                            layer.msg("控制失败",{icon:2});
                                        }else if(resContent.code == -2){
                                            layer.msg("应答超时",{icon:2});
                                        }else {
                                            layer.msg("控制失败",{icon:2});
                                        }
                                    }
                                }else {
                                    layer.msg("控制失败",{icon:2});
                                }
                            }else {
                                layer.msg("控制失败",{icon:2});
                            }
                        })
                    }else {
                        $.postJSON(deviceServiceUrl + "/mode/controlMode?id=" + dataList[id][params.menuName+"Id"], {}, function(data) {
                            $.hide_overall_loding();
                            if(data.code == 0) {
                                layer.msg("成功", {
                                    icon: 1
                                });
                                return true;
                            }
                            layer.msg("操作失败", {
                                icon: 2
                            });
                        });
                    }
                })
            });
            $("#DemoBox").css('display', "block");
        });*/
    }

   /* $(".goOff").on("click", function() {
        // alert("你点击了关闭按钮");
        $("#DemoBox").css({
            display: "none"
        });
    });*/
    //控制设备结束

    //绑定设备模式
    function bandingModel(id){
        let dataList = $("#deviceEventList").bootstrapTable("getData");
        if(dataList[id].menuType == null){
            layer.msg("未选择具体几路几键",{icon: 2});
            return;
        }
        $.getJSON(deviceServiceUrl + "/threeSwitchMenu/list",{deviceId:dataList[id].id},function (getRes) {
            if(getRes.code == 0){
                let resList = getRes.data.list;
                if (resList == null || resList.length == 0) {
                    layer.msg("没有获取到按键数！", {
                        icon: 2
                    })
                }else {
                    openWindow(resList,dataList[id]);
                }
            }else{
                layer.msg("获取不到按键数！", {
                    icon: 2
                });
            }
        });
    }

    function openWindow(resList,deviceData) {
        html = template("detailWindow",{title:"绑定模式 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "绑定模式",
            area: ['500px','470px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['确定','取消'],
            yes: function (index, layero) {
                /*let formData = {};
                formData.id = dataList[id].id;
                formData.deviceId = dataList[id].id;
                formData.menuOne = $("#menuOne").val();
                formData.menuOneId = $("#menuOneId").val();
                formData.menuTwo = $("#menuTwo").val();
                formData.menuTwoId = $("#menuTwoId").val();
                formData.menuThree = $("#menuThree").val();
                formData.menuThreeId = $("#menuThreeId").val();
                formData.menuA = $("#menuA").val();
                formData.menuAId = $("#menuAId").val();
                formData.menuB = $("#menuB").val();
                formData.menuBId = $("#menuBId").val();
                formData.menuC = $("#menuC").val();
                formData.menuCId = $("#menuCId").val();
                formData.menuD = $("#menuD").val();
                formData.menuDId = $("#menuDId").val();
                $.getJSON(deviceServiceUrl + "/device/bandingModel",formData,function (bandingRes) {
                    if(bandingRes.code == 0){
                        layer.close(myLayer);
                        $('#deviceEventList').bootstrapTable('refresh');
                    }else{
                        layer.msg("修改失败！", {
                            icon: 2
                        });
                    }
                });
                layer.close(myLayer);*/
                $.show_overall_loding();
                let switchMap = {switchList:[]};
                for(let i=0; i<resList.length; i++){
                    let menuData = {};
                    menuData.id = resList[i].id;
                    menuData.modeId = $("#modeId" + i).val();
                    switchMap.switchList.push(menuData);
                }
                $.postJSON(deviceServiceUrl +"/threeSwitchMenu/update",switchMap,function (updateRes) {
                    $.hide_overall_loding();
                    layer.close(myLayer);
                    if(updateRes.code == 0){
                        layer.msg("修改成功",{icon:1});
                    }else {
                        layer.msg("修改失败",{icon:2});
                    }
                });
            },
            success: function (layero) {
                let menuTypeList = ["三路三键","三路四键","三路五键","三路六键","两路两键","两路三键","两路四键","两路五键","两路六键","一路一键"];
                $("#menuTypeName").val(menuTypeList[deviceData.menuType-1]);
                let contentHtml = '';
                for (let i = 0; i < resList.length; i++) {
                    let modeName = resList[i].modeName
                    if(!modeName){
                        modeName = "未绑定模式";
                    }
                    contentHtml += '<div class="layui-row layui-col-space10 layui-form-item" id="menuOneDiv">\n' +
                        '<div class="col-lg-8 MarginPx">\n' +
                        '<label class="layui-form-label">'+resList[i].menuName+':</label>\n' +
                        '<div class="layui-input-block">\n' +
                        '<input class="form-control" id="modeName'+i+'" name="modeName'+i+'" value="'+modeName+'" type="text" readonly>\n' +
                        '<input class="form-control" id="modeId'+i+'" name="modeId'+i+'" type="text" value="'+resList[i].modeId+'" style="display:none">\n' +
                        '</div>\n' +
                        '</div>\n' +
                        '<div class="col-lg-2 MarginPx">\n' +
                        '<button style="width: 100%;" type="button" class="btn btn-cyan" onclick="selectModel('+i+')">选择</button>\n' +
                        '</div>\n' +
                        '<div class="col-lg-2 MarginPx">\n' +
                        '<button style="width: 100%;" type="button" class="btn btn-warning" onclick="cancelModel('+i+')">取消</button>\n' +
                        '</div>\n' +
                        '</div>'
                }
                $("#eventDetailForm").append(contentHtml);

            }
        });
    }

    //取消选择模式
    function cancelModel(btnIndex) {
        /*if(btnIndex == 1){
            $("#menuOne").val("");
            $("#menuOneId").val("");
        }else if(btnIndex == 2){
            $("#menuTwo").val("");
            $("#menuTwoId").val("");
        }else if(btnIndex == 3){
            $("#menuThree").val("");
            $("#menuThreeId").val("");
        }else if(btnIndex == 4){
            $("#menuA").val("");
            $("#menuAId").val("");
        }else if(btnIndex == 5){
            $("#menuB").val("");
            $("#menuBId").val("");
        }else if(btnIndex == 6){
            $("#menuC").val("");
            $("#menuCId").val("");
        }else if(btnIndex == 7){
            $("#menuD").val("");
            $("#menuDId").val("");
        }*/
        $('#modeName' + btnIndex).val("");
        $('#modeId' + btnIndex).val("");
    }
    //取消选择模式结束
    //选择所有模式开始
    function selectModel(btnIndex){
        html = template("selectUserWindow",{title:"选择模式 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "选择模式",
            area: ['800px','500px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['确定','取消'],
            yes: function (index, layero) {
                let rows = $("#select_table2").bootstrapTable("getSelections");
                if(rows.length > 1){
                    layer.msg("只能选择一条数据",{icon:2});
                }else if(rows.length == 0){
                    layer.msg("请选择一条数据",{icon:2});
                }else{
                    $('#modeName' + btnIndex).val(rows[0].modeName);
                    $('#modeId' + btnIndex).val(rows[0].id);
                    layer.close(myLayer);
                }
            },
            success: function (layero) {
                //表格渲染开始
                $('#select_table2').bootstrapTable({
                    url: deviceServiceUrl + "/mode/list", //请求后台的URL（*）
                    //data: data1,                            //本地数据
                    method: 'get', //请求方式（*）
                    contentType: "application/x-www-form-urlencoded",
                    toolbar: '', //工具按钮用哪个容器
                    striped: true, //是否显示行间隔色
                    cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true, //是否显示分页（*）
                    sortable: false, //是否启用排序
                    sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1, //初始化加载第一页，默认第一页
                    pageSize: 10, //每页的记录行数（*）
                    pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
                    queryParamsType: '',
                    queryParams: select_queryParams2, //传递参数（*）
                    strictSearch: true,
                    // height: 500,                            //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                    uniqueId: "id", //每一行的唯一标识，一般为主键列
                    cardView: false, //是否显示详细视图
                    detailView: false, //是否显示父子表
                    clickToSelect: true, //点击行是否选中
                    responseHandler: function (data) {
                        let res = [];
                        if (data.code == 0) {
                            let result = data.data;
                            rdata = result.list;
                            res.push({
                                total: result.total,
                                rows: result.list
                            });
                            $.hide_overall_loding();
                            return res[0];
                        } else {
                            res.push({
                                total: 0,
                                rows: []
                            });
                            layer.msg("获取数据失败！", {icon: 2});
                            $.hide_overall_loding();
                            return res[0];
                        }
                    },
                    onLoadSuccess: function () {
                        $.hide_overall_loding();
                    },
                    onDblClickRow: function (row) {
                        console.info(row);
                    },
                    columns: [{
                        checkbox: true
                    }, {
                        width: 50,
                        title: '序号',
                        formatter: function (value, row, index) {
                            let pageSize = $('#select_table2').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                            let pageNumber = $('#select_table2').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                            return pageSize * (pageNumber - 1) + index + 1;
                        }
                    }, {
                        field: 'modeName',
                        title: '模式名称',
                        width: 100
                    }, {
                        field: 'enableMode',
                        title: '激活模式',
                        width: 100,
                        formatter: function(value, row, index) {
                            var state = "";
                            if(value == 0) {
                                state = '<span style="color:red">未激活</span>'
                            } else if(value == 1) {
                                state = '<span style="color:green">已激活</span>'
                            }
                            return state;
                        }
                    },{
                        field: 'createDate',
                        title: '创建时间',
                        width: 100
                    }]
                });
                //表格渲染结束
                //查询参数
                function select_queryParams2(params) {
                    return {
                        token: $.getToken(),
                        pageSize: params.pageSize,
                        pageNum: params.pageNumber,
                        modeName:$("#select_userName").val(),
                        enableMode:$("#select_userPhone").val(),
                    };
                }
                //自动搜索
                $("#select_userName").change(function () {
                    $('#select_table2').bootstrapTable('refresh');
                });
                $("#select_userPhone").change(function () {
                    $("#select_table2").bootstrapTable("refresh");
                });
            }
        });
    }
    //选择所有模式结束
    //绑定设备模式


    //修改事件开始
    function editEvent(id){
        let dataList = $("#deviceEventList").bootstrapTable("getData");
        html = template("editWindow",{title:"几路几键 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "几路几键",
            area: ['350px','300px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['提交','取消'],
            yes: function (index, layero) {
                if($("#e_menuType").val() != dataList[id].menuType){
                    let confirmLayer = layer.confirm("修改设备按键数会清空该设备所有绑定模式",["确定","取消"],function () {
                        layer.close(confirmLayer);
                        layer.close(myLayer);
                        let formData = {};
                        formData.token = $.getToken();
                        if(dataList[id].menuTypeId != null){
                            formData.id = dataList[id].menuTypeId;
                        }
                        if(dataList[id].id != null){
                            formData.deviceId = dataList[id].id;
                        }
                        formData.menuType = $("#e_menuType").val();
                        $.getJSON(deviceServiceUrl + "/device/saveMenuType",formData,function (updateRes) {
                            if(updateRes.code == 0){
                                layer.close(myLayer);
                                $('#deviceEventList').bootstrapTable('refresh');
                            }else{
                                layer.msg("修改失败！", {
                                    icon: 2
                                });
                            }
                        })
                    })
                }else {
                    layer.close(myLayer);
                }
            },
            success: function (layero) {
                $("#e_deviceName").val(dataList[id].deviceName);
                let sanHtml = '<option value="">请选择几路几键</option><option value="1">三路三键</option><option value="2">三路四键</option>'+
                '<option value="3">三路五键</option><option value="4">三路六键</option>';
                let twoHtml = '<option value="">请选择几路几键</option><option value="5">两路两键</option><option value="6">两路三键</option>'+
                    '<option value="7">两路四键</option><option value="8">两路五键</option><option value="9">两路六键</option><option value="10">一路一键</option>';
                if(dataList[id].productCode == "00001301"){
                    $("#e_menuType").html(sanHtml);
                }else {
                    $("#e_menuType").html(twoHtml);
                }
                $("#e_menuType").val(dataList[id].menuType);
            }
        });
    }
    //修改事件结束


</script>

<!--详情弹框-->
<script type="text/html" id="detailWindow">
    <section class="openDetail" style="width: 95%; margin-top: 20px;">
        <div class="panel-body">
            <form id="eventDetailForm">
                <div class="layui-row layui-col-space10 layui-form-item">
                    <div class="col-lg-12 MarginPx">
                        <label class="layui-form-label">几路几键:</label>
                        <div class="layui-input-block">
                            <input class="form-control" id="menuTypeName" name="menuTypeName" type="text" readonly>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </section>
</script>
<!--详情弹框结束-->
<!--编辑弹框-->
<script type="text/html" id="editWindow">
    <section class="openDetail" style="width: 95%; margin-top: 20px;">
        <div class="panel-body">
            <form id="eventEditForm">
                <div class="layui-row layui-col-space10 layui-form-item">
                    <div class="col-lg-12 MarginPx">
                        <label class="layui-form-label">设备名称:</label>
                        <div class="layui-input-block">
                            <input class="form-control" id="e_deviceName" name="deviceName" type="text" readonly>
                        </div>
                    </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                    <div class="col-lg-12 MarginPx">
                        <label class="layui-form-label">几路几键:</label>
                        <div class="layui-input-block">
                            <select class="form-control selectpickers" style="max-height: 50px;" name="deviceType" id="e_menuType" data-live-search="true">
                                <option value="">请选择几路几键</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </section>
</script>
<!--编辑弹框结束-->
<!--选择用户弹框开始-->
<script type="text/html" id="selectUserWindow">
    <section class="openDetail" style="width: 95%; margin-top: 20px;">
        <div class="panel-body">
            <form id="selectUserForm">
                <div class="layui-row layui-col-space10 layui-form-item">
                    <div class="col-lg-6 MarginPx">
                        <label class="layui-form-label">模式名称:</label>
                        <div class="layui-input-block">
                            <input class="form-control" id="select_userName" name="userName" type="text">
                        </div>
                    </div>
                    <div class="col-lg-6 MarginPx">
                        <label class="layui-form-label">激活模式:</label>
                        <div class="layui-input-block">
                            <!--<input class="form-control" id="select_userPhone" name="userPhone" type="text">-->
                            <select class="form-control" id="select_userPhone" name="userPhone">
                                <option value="">激活模式</option>
                                <option value="0">未激活</option>
                                <option value="1">已激活</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
            <table id="select_table2"></table>
        </div>
    </section>
</script>
<!--选择用户弹框结束-->
</html>