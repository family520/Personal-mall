<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../images/logoIcon.png" type="image/icon"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>【光大银行】智慧综合管理系统</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../css/style.min.css" rel="stylesheet">
    <link href="../plus/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="../css/bootstrap-treeview.css" rel="stylesheet">
    <link href="../css/commonStyle.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/template-web.js"></script>
    <script src="../js/bootstrap-treeview.js"></script>
    <script src="../plus/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../plus/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="../plus/layer/layer.js"></script>
    <script src="../plus/validate/jquery.validate.min.js"></script>
    <script src="../plus/validate/messages_zh.min.js"></script>
    <!--时间选择插件-->
    <link href="../plus/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <script src="../plus/bootstrap-datetimepicker/moment.min.js"></script>
    <script src="../plus/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
    <script src="../plus/bootstrap-datetimepicker/locale/zh-cn.js"></script>
    <!--日期选择插件-->
    <link href="../plus/bootstrap-datepicker/bootstrap-datepicker3.min.css" rel="stylesheet">
    <script src="../plus/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="../plus/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>

    <script src="../js/httpUtils.js"></script>
    <script src="../js/Md5.js"></script>
    <script src="../plus/iview/vue.min.js"></script>
    <style type="text/css">
        .btn {
            padding: 8px;
        }

        .layui-form-label {
            width: 95px !important;
        }

        .form-control {
            width: 99% !important;
        }

        .inlineBlock {
            width: 40%;
            display: inline-block;
        }
    </style>
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!--加载头部和菜单栏-->
        <div id="hander">
            <script>
                $(function () {
                    $("#hander").load("handMenu.html");
                });
            </script>
        </div>
        <!--页面主要内容-->
        <main class="lyear-layout-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>定时任务</h4>
                            </div>
                            <div class="card-body">
                                <div class="ibox-content row">
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-label" for="s_typeName">定时任务名称：</label>
                                            <input class="form-control" name="s_typeName" id="s_typeName" placeholder="定时任务名称"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <div style="margin-top: 24px;">
                                                <button type="button" class="btn btn-purple" id="clean"><i class="fa fa-eraser"></i> 清空</button>
                                                <button type="button" class="btn btn-success" id="search" style="margin-left: 10px"><i class="fa fa-search"></i> 查询</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Start-->
                                <div>
                                    <button type="button" class="btn btn-primary" id="add">
                                        <i class="fa fa-plus"></i> 录入
                                    </button>
                                </div>
                                <div id="classifyList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!--End 页面主要内容-->

    </div>
</div>
<!--加载底部-->
<div id="footer" class="classifyFooter">
    <script type="text/javascript">
        $(function () {
            $("#footer").load("footer.html");
        });
    </script>
</div>
<div id="loadDiv"></div>
</body>
<script type="text/javascript">
    $("#loadDiv").html(loadHtml);
    var html;
    var url = "";
    $(function () {
        $('#classifyList').bootstrapTable({
            url: deviceServiceUrl + "/timerTaskQuartz/list",       //请求后台的URL（*）
            //data: data1,                            //本地数据
            method: 'get', //请求方式（*）
            contentType: "application/x-www-form-urlencoded",
            toolbar: '', //工具按钮用哪个容器
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sortable: false, //是否启用排序
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 10, //每页的记录行数（*）
            pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
            queryParamsType: '',
            queryParams: queryParams, //传递参数（*）
            strictSearch: true,
            // height: 500,                            //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "id", //每一行的唯一标识，一般为主键列
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            clickToSelect: true, //点击行是否选中
            responseHandler: function (data) {
                var res = [];
                if (data.code === 0) {
                    var result = data.data;
                    rdata = result.list;
                    res.push({
                        total: result.total,
                        rows: result.list
                    });
                    $.hide_overall_loding();
                    return res[0];
                } else {
                    res.push({
                        total: 0,
                        rows: []
                    });
                    layer.msg("获取数据失败！", {icon: 2});
                    $.hide_overall_loding();
                    return res[0];
                }
            },
            onLoadSuccess: function () {
                $.hide_overall_loding();
            },
            onDblClickRow: function (row) {
                console.info(row);
            },
            columns: [
                {
                    width: 100,
                    title: '序号',
                    formatter: function (value, row, index) {
                        var pageSize = $('#classifyList').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                        var pageNumber = $('#classifyList').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                        return pageSize * (pageNumber - 1) + index + 1;
                    }
                },{
                    field: 'taskName',
                    title: '定时任务名称',
                    width: 300
                }, {
                    field: 'taskOnTrigger',
                    title: '开启时间',
                    width: 300,
                    formatter: function (value, row, index) {
                        let state = "-";
                        if(value) {
                            state = parsingCron(value).whp
                        }
                        return state;
                    }
                }, {
                    field: 'modeIdOnName',
                    title: '开启模式',
                    width: 200
                }, {
                    field: 'isTaskOnActive',
                    title: '是否激活',
                    width: 100,
                    formatter: function (value, row, index) {
                        var state = "";
                        if (value == 0) {
                            state = '<span style="color:red">未激活</span>'
                        } else if (value == 1) {
                            state = '<span style="color:green">已激活</span>'
                        }
                        return state;
                    }
                },{
                    field: 'taskOffTrigger',
                    title: '关闭时间',
                    width: 300,
                    formatter: function (value, row, index) {
                        let state = "-";
                        if(value) {
                            state = parsingCron(value).whp
                        }
                        return state;
                    }
                },{
                    field: 'modeIdOffName',
                    title: '关闭模式',
                    width: 200
                },{
                    field: 'isTaskOffActive',
                    title: '是否激活',
                    width: 100,
                    formatter: function (value, row, index) {
                        var state = "";
                        if (value == 0) {
                            state = '<span style="color:red">未激活</span>'
                        } else if (value == 1) {
                            state = '<span style="color:green">已激活</span>'
                        }
                        return state;
                    }
                }, {
                    title: "操作",
                    width: 200,
                    clickToSelect: false,
                    formatter: function (i1, i2, i3) {
                        var str =
                            // '<button data-toggle="tooltip" title="详情" type="button" onclick="detail(' + i3 + ');" class="btn btn-info tableButton"><i class="fa fa-info-circle"></i></button>' +
                            '<button data-toggle="tooltip" title="编辑" type="button" onclick="updata(' + i3 + ');" class="btn btn-warning tableButton"><i class="fa fa-pencil-square"></i></button>' +
                            '<button data-toggle="tooltip" title="删除" type="button" onclick="tabRemove(' + i3 + ');" class="btn btn-danger tableButton"><i class="fa fa-trash-o"></i></button>';
                        return str;
                    },
                    cellStyle: function () {
                        return {
                            classes: "",
                            css: {
                                "text-align": "center"
                            }
                        }
                    }
                }]
        });

        function queryParams(params) {
            $.show_overall_loding();
            return {
                token: $.getToken(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
                taskName: $("#s_typeName").val(),
            };
        }

        $("#add").on("click", function () {
            url = "";
            showModel("添加定时任务", 1, 0);
        });

        $("#search").on("click", function () {
            $('#classifyList').bootstrapTable('refresh');
        });

        $("#clean").click(function() {
            $("#s_typeName").val("");
            $("#search").trigger("click");
        });
    });

    // 修改定时任务
    function updata(val) {
        showModel("修改定时任务", 2, val);
    }

    // 删除定时任务
    function tabRemove(val) {
        var data = $("#classifyList").bootstrapTable('getData');
        console.info(data[val]);
        var id = data[val].id;
        layer.confirm('确定删除？', {
            btn: ['确定', '取消'] //按钮
        }, function () {
            $.show_overall_loding();
            $.deleteJSON(deviceServiceUrl + "/timerTaskQuartz/delete?id=" + id, {}, function (data) {
                console.info(data);
                $.hide_overall_loding();
                if (data.code === 0) {
                    layer.msg('删除成功', {icon: 1});
                    $('#classifyList').bootstrapTable('refresh');
                }else{
                    layer.msg('删除失败', {icon: 2});
                }
            });
        });
    }

    // 生成cron表达式
    function generateCron(time, week) {
        let s = "0"
            ,p = "?"
            ,h = "?"
            ,d = "?"
            ,m = "*"
            ,w = "?"
            ,y = "*"
        const times = time.split(":")
        h = parseInt(times[0]) + "";
        p = parseInt(times[1]) + ""

        let weekList = ""
        for(let i = 0, length = week.length; i < length; i++) {
            if(length === 7) {
                weekList = "*"
            } else {
                if(i === length - 1) {
                    weekList += week[i].value
                } else {
                    weekList += week[i].value + ","
                }
            }
        }
        w = weekList.trim() ? weekList.trim() : w
        return s + " " + p + " " + h + " " + d + " " + m + " " + w
    }
    // 解析cron表达式
    function parsingCron(cron) {
        let w = "每天"
            ,p = "00"
            ,h = "00"
            ,week = ""
            ,wh = ""
        if(cron) {
            const crons = cron.split(" ")
            for(let i = 0, length = crons.length; i < length; i++) {
                p = crons[1]
                h = crons[2]
                week = crons[5]
                if (week === "*") {
                    wh = "每天"
                } else if (week === "?") {
                    wh = "没选"
                } else {
                    w = week.replace(/,/g, "、周")
                    w = w.replace(/MON/, "一")
                    w = w.replace(/TUE/, "二")
                    w = w.replace(/WED/, "三")
                    w = w.replace(/THU/, "四")
                    w = w.replace(/FRI/, "五")
                    w = w.replace(/SAT/, "六")
                    w = w.replace(/SUN/, "日")
                    wh = "周" + w
                }
            }
            return {
                hp: h + ":" + p,
                week,
                whp: "周期：" + wh + " 。时间：" + h + ":" + p
            }
        }
    }

    function setInputCheck(data, id) {
        if(parsingCron(data)) {
            const on = parsingCron(data).week
            if(on === "*") {
                $('#'+(id)+' > input').prop("checked", true)
            } else if (on === "?") {
                $('#'+(id)+' > input').prop("checked", false)
            } else {
                const ons = on.split(",")
                for(let i = 0, length = ons.length; i < length; i++) {
                    $('#'+(id)+' > input[value='+(ons[i])+']').prop("checked", true)
                }
            }
        }
    }

    function showModel(title, flag, index) {
        html = template("timerModel", {title: "123"});
        var myLayer = layer.open({
            skin: 'card', //自定义样式winning-class
            type: 1,
            title: [title, ""],
            area: ['700px', '500px'], //宽高
            // maxHeight: '500px',
            resize: true, //是否拉升
            offset: 'auto', //居中
            content: html,
            maxmin: true,
            btn: ['提交', '取消'],
            yes: function (index, layero) {
                $("#modeForm").submit();
            },
            success: function (layero) {
                initDatepicker('.js-datetimepicker1','.js-datepicker1')
                initDatepicker('.js-datetimepicker2','.js-datepicker2')

                init_o_Tree();

                if (flag === 2) {
                    var data = $("#classifyList").bootstrapTable('getData')[index];
                    console.log(data)
                    $("#id").val(data.id);
                    // $("#organizationName").val(data.organizationName);
                    // $("#organizationId").val(data.organizationId);
                    $("#taskName").val(data.taskName);
                    $("#timerTime1").val(parsingCron(data.taskOnTrigger)?parsingCron(data.taskOnTrigger).hp:'');
                    $("#timerTime2").val(parsingCron(data.taskOffTrigger)?parsingCron(data.taskOffTrigger).hp:'');
                    $("#isTaskOnActive").val(data.isTaskOnActive?"1":"0");
                    $("#isTaskOffActive").val(data.isTaskOffActive?"1":"0");
                    $("#remarks").val(data.remarks);

                    $("#taskOnId").val(data.taskOnId);
                    $("#taskOffId").val(data.taskOffId);

                    setInputCheck(data.taskOnTrigger, "onWeek")
                    setInputCheck(data.taskOffTrigger, "offWeek")

                    initModelTable('#modelTable', data.modeIdOn);
                    initModelTable('#modelTable1', data.modeIdOff);

                } else {
                    initModelTable('#modelTable');
                    initModelTable('#modelTable1');
                }
            }
        });
        var validate = $("#modeForm").validate({
            rules: {
                taskName: {
                    required: true
                },
                organizationName: {
                    required: true
                }
            },
            messages: {
                taskName: {
                    required: "定时任务名称不能为空"
                },
                organizationName: {
                    required: "组织机构不能为空"
                }
            },
            submitHandler: function (form) {
                $.show_overall_loding();

                let formData = {};

                const startTime1 = $('#timerTime1').val()
                const startTime2 = $('#timerTime2').val()

                const onWeek = $('#onWeek > input:checked')
                const offWeek = $('#offWeek > input:checked')

                let modelTable = $("#modelTable").bootstrapTable("getSelections");
                let modelTable1 = $("#modelTable1").bootstrapTable("getSelections");

                if(!startTime1 && !startTime2) {
                    layer.msg("开启时间和关闭时间至少选择一个")
                    $.hide_overall_loding()
                    return;
                } else {
                    if(startTime1) {
                        if(onWeek.length === 0) {
                            layer.msg("请选择开启定时器周期")
                            $.hide_overall_loding()
                            return;
                        }
                        formData.taskOnTrigger = generateCron(startTime1, onWeek)
                        if(modelTable.length === 1) {
                            $('#modeIdOn').val(modelTable[0].id)
                        } else {
                            layer.msg("请选择开启定时器绑定模式")
                            $.hide_overall_loding()
                            return;
                        }
                    }
                    if(startTime2) {
                        if(offWeek.length === 0) {
                            layer.msg("请选择关闭定时器周期")
                            $.hide_overall_loding()
                            return;
                        }
                        formData.taskOffTrigger = generateCron(startTime2, offWeek)
                        if(modelTable1.length === 1) {
                            $('#modeIdOff').val(modelTable1[0].id)
                        } else {
                            layer.msg("请选择关闭定时器绑定模式")
                            $.hide_overall_loding()
                            return;
                        }
                    }
                }
                formData.id = $('#id').val();
                // formData.organizationId = $("#organizationId").val();
                // formData.organizationName = $("#organizationName").val();
                formData.taskName = $("#taskName").val();
                formData.modeIdOn = $("#modeIdOn").val();
                formData.isTaskOnActive = $("#isTaskOnActive").val()==="1";
                formData.modeIdOff = $("#modeIdOff").val();
                formData.isTaskOffActive = $("#isTaskOffActive").val()==="1";
                formData.remarks = $("#remarks").val();

                formData.taskOffId = $("#taskOffId").val();
                formData.taskOnId = $("#taskOnId").val();
                console.log('formData---',formData)

                if(formData.id) {
                    $.putJSON(deviceServiceUrl + "/timerTaskQuartz/update", formData, function(data) {
                        $.hide_overall_loding();
                        console.log('修改定时任务结果------',data);
                        if(data.code === 0) {
                            layer.close(myLayer);
                            layer.msg("修改成功", {icon: 1});
                            $('#classifyList').bootstrapTable('refresh');
                        } else {
                            layer.msg("操作失败", {icon: 2});
                        }
                    });
                } else {
                    $.postJSON(deviceServiceUrl+"/timerTaskQuartz/save", formData,
                        function (addRes) {
                            console.log('新增定时任务结果------',addRes);
                            $.hide_overall_loding();
                            if(addRes.code === 0){
                                layer.close(myLayer);
                                layer.msg("添加成功", {icon: 1});
                                $("#classifyList").bootstrapTable("refresh");
                            }else{
                                layer.msg("添加失败",{icon:2});
                            }
                        }
                    );
                }
            }
        });
    }

    var organizationData = "";
    function get_o_TreeData(data) {
        var rdata = [];
        for(var i = 0; i < data.length; i++) {
            var node = data[i];
            var one = {};
            one.text = node.organizationName;
            one.id = node.id;
            if(node.childrens !== undefined && node.childrens != null && node.childrens !== '') {
                one.nodes = get_o_TreeData(node.childrens);
            }
            rdata.push(one);
        }
        return rdata;
    }

    function init_o_Tree() {
        if(organizationData === "") {
            $.sanjiGetJSON(userServiceUrl + "/organization/treeList", {}, function(data) {
                organizationData = get_o_TreeData(data.data);
                initTreeData();
            });
            return;
        }
        initTreeData();
    }

    function initTreeData() {
        var options = {
            checkedIcon: "glyphicon glyphicon-check",
            nodeIcon: "none", //所有节点的默认图标
            levels: 1,
            data: organizationData,
            onhoverColor: "rgba(0,0,0,0.1)",
            onNodeSelected: function(event, data) {
                $("#organizationName").val(data.text);
                $("#organizationId").val(data.id);
                $("#organizationTree").hide();
            }
        };
        $('#organizationTree').treeview(options);
    }
</script>

<!--添加修改定时任务模板-->
<script type="text/html" id="timerModel">
    <section class="openDetail" style="width: 95%;">
        <div class="panel-body">
            <form id="modeForm">
                <div class="layui-row layui-col-space10 layui-form-item" id="modelApp">
                    <input type="hidden" name="id" id="id"/>
                    <div class="clearfix">
                        <!--<div class="col-lg-6">-->
                            <!--<label class="control-label">组织机构:</label>-->
                            <!--<div>-->
                                <!--<input class="form-control organizationInput" id="organizationName" name="organizationName" type="text" onclick="$('#organizationTree').show();" readonly="readonly" style="cursor: pointer">-->
                                <!--<input type="hidden" id="organizationId" name="organizationId" value="">-->
                            <!--</div>-->
                            <!--<div id="organizationTree" style="display: none; width: 250px;margin-left: 110px; position: absolute;z-index: 999;background-color: #FFF;"></div>-->
                        <!--</div>-->
                        <div class="col-lg-12">
                            <label for="taskName" class="control-label">定时任务名称：</label>
                            <div>
                                <input type="text" class="form-control" id="taskName" name="taskName">
                            </div>
                        </div>
                    </div>
                    <div style="border: 1px solid gainsboro; margin-left:15px;">
                        <div>
                            <div class="form-group inlineBlock">
                                <label for="timerTime1" class="control-label">定时任务开启时间：</label>
                                <div style="position: relative;">
                                    <input class="form-control js-datetimepicker1" type="text" id="timerTime1" name="timerTime1"
                                           placeholder="" value="" data-side-by-side="true" data-locale="zh-cn"
                                           data-format="HH:mm"/>
                                </div>
                            </div>
                            <div class="form-group inlineBlock" style="margin-left: 50px;">
                                <label for="isTaskOnActive" class="control-label">是否激活：</label>
                                <select class="form-control" id="isTaskOnActive" name="isTaskOnActive">
                                    <option value="0">否</option>
                                    <option value="1">是</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">定时任务周期：</label>
                            <input type="hidden" id="taskOnTrigger" name="taskOnTrigger"/>
                            <input type="hidden" id="taskOnId" name="taskOnId"/>
                        </div>
                        <div class="form-group">
                            <div class="onWeek" id="onWeek">
                                <input id="one" type="checkbox" value="MON" /><label for="one" class="control-label">周一</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="two" type="checkbox" value="TUE" /><label for="two" class="control-label">周二</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="three" type="checkbox" value="WED" /><label for="three" class="control-label">周三</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="four" type="checkbox" value="THU" /><label for="four" class="control-label">周四</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="five" type="checkbox" value="FRI" /><label for="five" class="control-label">周五</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="six" type="checkbox" value="SAT" /><label for="six" class="control-label">周六</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="seven" type="checkbox" value="SUN" /><label for="seven" class="control-label">周日</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="modelTable" class="control-label">开启定时任务绑定模式：</label>
                            <div>
                                <div id="modelTable"></div>
                            </div>
                            <input type="hidden" id="modeIdOn" name="modeIdOn" />
                        </div>
                    </div>

                    <div style="border: 1px solid gainsboro; margin-left:15px;margin-top: 10px;">
                        <div>
                            <div class="form-group inlineBlock">
                                <label class="control-label">定时任务关闭时间：</label>
                                <div style="position: relative;">
                                    <input class="form-control js-datetimepicker2" type="text" id="timerTime2" name="timerTime2"
                                           placeholder="" value="" data-side-by-side="true" data-locale="zh-cn"
                                           data-format="HH:mm"/>
                                </div>
                            </div>
                            <div class="form-group inlineBlock" style="margin-left: 50px;">
                                <label for="isTaskOffActive" class="control-label">是否激活：</label>
                                <select class="form-control" id="isTaskOffActive" name="isTaskOffActive">
                                    <option value="0">否</option>
                                    <option value="1">是</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">定时任务周期：</label>
                            <input type="hidden" id="taskOffTrigger" name="taskOffTrigger"/>
                            <input type="hidden" id="taskOffId" name="taskOffId"/>
                        </div>
                        <div class="form-group">
                            <div class="offWeek" id="offWeek">
                                <input id="mon" type="checkbox" value="MON" /><label for="mon" class="control-label">周一</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="tues" type="checkbox" value="TUE" /><label for="tues" class="control-label">周二</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="wednes" type="checkbox" value="WED" /><label for="wednes" class="control-label">周三</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="thurs" type="checkbox" value="THU" /><label for="thurs" class="control-label">周四</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="fri" type="checkbox" value="FRI" /><label for="fri" class="control-label">周五</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="satur" type="checkbox" value="SAT" /><label for="satur" class="control-label">周六</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input id="sun" type="checkbox" value="SUN" /><label for="sun" class="control-label">周日</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="modelTable" class="control-label">关闭定时器绑定模式：</label>
                            <div>
                                <div id="modelTable1"></div>
                            </div>
                            <input type="hidden" id="modeIdOff" name="modeIdOff"/>
                        </div>
                    </div>

                    <div class="form-group" style="margin-left: 15px;">
                        <label for="remarks" class="control-label">定时任务说明：</label>
                        <div>
                            <textarea class="card" rows="5"
                                      style="width: 99%;font-size: 16px;border: 1px solid rgba(179, 179, 179, 0.3)"
                                      id="remarks" name="remarks"></textarea>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </section>
</script>

<script>

    function initModelTable(id,modeId) {
        $(id).bootstrapTable({
            url: deviceServiceUrl + "/mode/list", //请求后台的URL（*）
            method: 'get', //请求方式（*）
            contentType: "application/x-www-form-urlencoded",
            toolbar: '', //工具按钮用哪个容器
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sortable: false, //是否启用排序
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 5, //每页的记录行数（*）
            pageList: [5, 10, 20, 50], //可供选择的每页的行数（*）
            queryParamsType: '',
            queryParams: queryParams1, //传递参数（*）
            strictSearch: true,
            uniqueId: "id", //每一行的唯一标识，一般为主键列
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            clickToSelect: true, //点击行是否选中
            singleSelect : true,
            responseHandler: function (data) {
                var res = [];
                if (data.code === 0) {
                    var result = data.data;
                    res.push({
                        total: result.total,
                        rows: result.list
                    });
                    return res[0];
                } else {
                    res.push({
                        total: 0,
                        rows: null
                    });
                    return res[0];
                }
            },
            onLoadSuccess: function () {
                $.hide_overall_loding();
            },
            columns: [
                {
                    checkbox: true,
                    formatter: function(value, row, index) {
                        if(modeId !== undefined) {
                            return row.id === modeId
                        }
                    }
                },
                {
                    width: 50,
                    title: '序号',
                    formatter: function (value, row, index) {
                        var pageSize = $(id).bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                        var pageNumber = $(id).bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                        return pageSize * (pageNumber - 1) + index + 1;
                    }
                }, {
                    field: 'modeName',
                    title: '模式名称',
                    width: 400
                }, {
                    field: 'modeReadme',
                    title: '模式说明',
                    width: 400
                }, {
                    field: 'enableMode',
                    title: '激活模式',
                    width: 400,
                    formatter: function (value, row, index) {
                        var state = "";
                        if (value === 0) {
                            state = '<span style="color:red">未激活</span>'
                        } else if (value === 1) {
                            state = '<span style="color:green">已激活</span>'
                        }
                        return state;
                    }
                }
            ]
        });


        var overAllIds = new Array(); //全局数组
        function getSelectCheck() {
            return overAllIds;
        }

        function examine(type, datas) {
            if (type.indexOf('uncheck') === -1) {
                $.each(datas,
                    function (i, v) {
                        // 添加时，判断一行或多行的 id 是否已经在数组里 不存则添加　
                        overAllIds.indexOf(v.id) === -1 ? overAllIds
                            .push(v.id) : -1;
                    });
            } else {
                $.each(datas, function (i, v) {
                    overAllIds.splice(overAllIds.indexOf(v.id), 1); //删除取消选中行
                });
            }
        }

        $('#table').on('uncheck.bs.table check.bs.table check-all.bs.table uncheck-all.bs.table', function (e, rows) {
            var datas = $.isArray(rows) ? rows : [rows]; // 点击时获取选中的行或取消选中的行
            examine(e.type, datas); // 保存到全局 Array() 里
        });

        function queryParams1(params) {
            $.show_overall_loding();
            return {
                token: $.getToken(),
                pageSize: params.pageSize,
                pageNum: params.pageNumber,
                modeName: $("#s_modeName").val(),
                modeReadme: $("#s_modeReadme").val(),
                enableMode: $("#s_enableMode").val()
            };
        }
    }

    function initDatepicker(time, date) {
        // 时间选择
        jQuery(time).each(function () {
            var $input = jQuery(this);
            $input.datetimepicker({
                format: $input.data('format') ? $input.data('format') : false,
                useCurrent: $input.data('use-current') ? $input.data('use-current') : false,
                locale: moment.locale('' + ($input.data('locale') ? $input.data('locale') : '') + ''),
                showTodayButton: $input.data('show-today-button') ? $input.data('show-today-button') : false,
                showClear: $input.data('show-clear') ? $input.data('show-clear') : false,
                showClose: $input.data('show-close') ? $input.data('show-close') : false,
                sideBySide: $input.data('side-by-side') ? $input.data('side-by-side') : false,
                inline: $input.data('inline') ? $input.data('inline') : false,
            });
        });

        // 日期选择
        jQuery(date).each(function () {
            var $input = jQuery(this);
            $input.datepicker({
                weekStart: 1,
                autoclose: true,
                todayHighlight: true,
                language: 'zh-CN',
            });
        });
    }

</script>
</html>
